!function(t,e){"function"==typeof define&&define.amd?define(underscore,backbone,loglevelfactory):"object"==typeof exports?module.exports=e(require("underscore"),require("backbone"),require("loglevel")):t.Amygdala=e(t._,t.backbone,t.loglevel)}(this,function(t,e,r){var i=function(i){return{underscore:t,backbone:e,loglevel:r}[i]};return(i=function n(t,e,r){function o(s,c){if(!e[s]){if(!t[s]){var u="function"==typeof i&&i;if(!c&&u)return u(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=e[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return o(r?r:e)},l,l.exports,n,t,e,r)}return e[s].exports}for(var a="function"==typeof i&&i,s=0;s<r.length;s++)o(r[s]);return o}({"9LYMek":[function(t,e){"use strict";var r=t("underscore"),i=t("backbone"),n=t("loglevel"),o=function(t){this._schema=t,this._store={},this._getURI=function(t){if(!this._schema[t]||!this._schema[t].url)throw new Error("Invalid type. Acceptable types are: "+Object.keys(this._schema));return this._schema.apiUrl+this._schema[t].url},this._set=function(t,e,i){if(!i||"error"!==i){var n=this._store[t]?this._store[t]:this._store[t]={},o=this._schema[t];Array.isArray(e)||(e=o.parse?o.parse(e):[e]),"[object Object]"===Object.prototype.toString.call(e)&&(e=[e]),r.each(e,function(e){r.each(this._schema[t].oneToMany,function(t,i){var n=e[i];n&&"[object Array]"===Object.prototype.toString.call(n)&&n.length>0&&"[object Object]"===Object.prototype.toString.call(n[0])&&(this._set(t,n),e[i]=r.map(n,function(t){return t[this._schema.idAttribute]}.bind(this)))}.bind(this)),r.each(this._schema[t].foreignKey,function(t,r){var i=e[r];i&&"[object Object]"===Object.prototype.toString.call(i)&&(this._set(t,[i]),e[r]=i[this._schema.idAttribute])}.bind(this)),n[e[this._schema.idAttribute]]=e}.bind(this))}},this._remove=function(t,e,r,i){console.log(t,e,r,i)},this.get=function(t,e,o){n.info("store:get",t,e);var a={type:"GET",url:o&&o.url?o.url:this._getURI(t),data:e};return i.ajax(a).always(r.partial(this._set,t).bind(this))},this.add=function(t,e,o){n.info("store:add",t,e);var a={type:"POST",url:o&&o.url?o.url:this._getURI(t),data:JSON.stringify(e),contentType:"application/json"};return i.ajax(a).always(r.partial(this._set,t).bind(this))},this.update=function(t,e,o){if(n.info("store:update",t,e,o),!e.url)throw new Error("Missing object.url attribute. A url attribute is required for a PUT request.");var a={type:"PUT",url:e.url,data:JSON.stringify(e),contentType:"application/json"};return i.ajax(a).always(r.partial(this._set,t).bind(this))},this.remove=function(t,e,o){if(n.info("store:delete",t,e,o),!e.url)throw new Error("Missing object.url attribute. A url attribute is required for a DELETE request.");var a={type:"DELETE",url:e.url,data:JSON.stringify(e),contentType:"application/json"};return i.ajax(a).always(r.partial(this._remove,t).bind(this))},this.findAll=function(t,e){var i=this._store[t];if(!i||!Object.keys(i).length)return[];if(void 0===e)return r.map(i,function(t){return t});if("[object Object]"===Object.prototype.toString.call(e))return r.filter(i,function(t){return r.findWhere([t],e)});throw new Error("Invalid query for findAll.")},this.find=function(t,e){var i=this._store[t];return i&&Object.keys(i).length?void 0===e?void 0:"[object Object]"===Object.prototype.toString.call(e)?r.findWhere(i,e):"[object String]"===Object.prototype.toString.call(e)?i[e]:void 0:void 0}};e.exports=o},{backbone:"5kFNoY",loglevel:"3ohSP0",underscore:"ZKusGn"}],amygdala:[function(t,e){e.exports=t("9LYMek")},{}],3:[function(t,e){e.exports=t("9LYMek")},{backbone:"5kFNoY",loglevel:"3ohSP0",underscore:"ZKusGn"}]},{},[3]))("amygdala")});